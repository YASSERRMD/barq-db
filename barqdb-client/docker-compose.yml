services:
  # Barq DB (the main vector database)
  barq-db:
    build: ../
    image: barq-db:latest
    container_name: barq-db
    ports:
      - "8080:8080"
      - "50051:50051"
    volumes:
      - barq_data:/app/data
    environment:
      - BARQ_ADDR=0.0.0.0:8080
      - RUST_LOG=info

  # BarqDB Client Backend (gRPC-Web proxy)
  client-backend:
    build: ./backend
    image: barqdb-client-backend:latest
    container_name: barqdb-client-backend
    ports:
      - "3001:3001"
    environment:
      - BARQ_GRPC_ADDR=http://barq-db:50051
      - RUST_LOG=info
    depends_on:
      - barq-db

  # BarqDB Client Frontend (Next.js)
  client-frontend:
    build: ./frontend
    image: barqdb-client-frontend:latest
    container_name: barqdb-client-frontend
    ports:
      - "3000:3000"
    environment:
      - NEXT_PUBLIC_GRPC_ADDR=http://localhost:3001
    depends_on:
      - client-backend

volumes:
  barq_data:
